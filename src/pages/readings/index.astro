---
import { getCollection } from "astro:content";

import AstroPageShell from "~/astro/AstroPageShell.astro";
import { getLayoutBackdropImageProps } from "~/components/layout/getLayoutBackdropImageProps";
import { Layout } from "~/components/layout/Layout";
import { getReadingLogProps } from "~/features/reading-log/getReadingLogProps";
import { ReadingLog } from "~/features/reading-log/ReadingLog";

const [readingsEntries, worksEntries, reviewsEntries, authorsEntries] =
  await Promise.all([
    getCollection("readings"),
    getCollection("works"),
    getCollection("reviews"),
    getCollection("authors"),
  ]);
const readingLogProps = await getReadingLogProps(
  readingsEntries.map((e) => e.data),
  worksEntries.map((e) => e.data),
  reviewsEntries.map((e) => e.data),
  authorsEntries.map((e) => e.data),
);
const backdropImageProps = await getLayoutBackdropImageProps("readings");
const deck = `"You interest me. Rather vaguely."`;
const metaDescription =
  "A list of every book or story I've read since 2022. Filter by title, work year, reading year, kind, or edition. Sort by oldest or newest.";
---

<AstroPageShell
  canonical={true}
  meta={{
    description: metaDescription,
  }}
  openGraph={{ description: deck, type: "website" }}
  title="Reading Log"
>
  <Layout
    backdrop={{
      backdropImageProps,
      deck,
      title: "Reading Log",
    }}
    className="bg-subtle"
  >
    <ReadingLog client:load {...readingLogProps} />
  </Layout>
</AstroPageShell>
