## 2026-02-24 - Stage 1: Foundation — New Shared Components

- What was implemented:
  - Created `src/components/filter-and-sort/FilterSection.tsx` — direct port from movie log. Collapsible details/summary with smooth height+opacity animations via direct DOM manipulation.
  - Created `src/components/filter-and-sort/FilterSection.spec.tsx` — direct port. 10 tests covering open/closed defaults, title, disclosure triangle, initial height, snapshots.
  - Created `src/components/filter-and-sort/AppliedFilters.tsx` — direct port. Renders removable filter chips wrapped in FilterSection. Adapted sample data in comments for book log domain (Kind/Novel vs Genre/Horror).
  - Created `src/components/filter-and-sort/AppliedFilters.spec.tsx` — adapted port. Same structure as movie log but uses book log categories (Kind, Search). 17 tests.
  - Created `src/components/fields/CheckboxListField.tsx` — direct port. Multi-select with selected-first sorting, show-more, clear, form reset listener, defaultValues sync via useEffect.
  - Created `src/components/fields/RangeSliderField.tsx` — direct port. Dual-handle range slider with formatValue, keyboard nav, ARIA attributes, screen-reader live region.
  - Created `src/components/fields/RangeSliderField.spec.tsx` — direct port. 20 tests.
  - Created `src/utils/grades.ts` — new file. Exports `gradeToLetter(number → string)` and `gradeToValue(string → number)` using the 2–16 scale (F-=2, A+=16). Consolidates two private copies that existed in api/reviews.ts and getAuthorTitlesProps.ts.

- Files changed:
  - NEW: src/components/filter-and-sort/FilterSection.tsx
  - NEW: src/components/filter-and-sort/FilterSection.spec.tsx
  - NEW: src/components/filter-and-sort/AppliedFilters.tsx
  - NEW: src/components/filter-and-sort/AppliedFilters.spec.tsx
  - NEW: src/components/fields/CheckboxListField.tsx
  - NEW: src/components/fields/RangeSliderField.tsx
  - NEW: src/components/fields/RangeSliderField.spec.tsx
  - NEW: src/utils/grades.ts

- Test results: 253 tests passed, 5 snapshots written (0 failures)

- **Learnings for future iterations:**
  - The movie log's `CheckboxListField` imports `LabelText` from `./LabelText` — the book log already has `src/components/fields/LabelText.tsx`, so no extra file needed.
  - `AppliedFilters.spec.tsx` was adapted (not pure port) to use book log categories (Kind/Novel, Search/title) instead of movie log categories (Genre/Horror) — keeps tests meaningful for this domain.
  - `src/utils/grades.ts` already existed in the movie log at the same path; the book log didn't have it yet.
  - The movie log's `grades.ts` only exported `gradeToLetter`; the spec requires also exporting `gradeToValue` — both are included.
  - All 8 Stage 1 tasks completed in one pass; no regressions in existing tests.

---

## 2026-02-24 - Stage 2: Field Updates + FilterAndSortContainer/Header

- What was implemented:
  - Modified `src/components/fields/GradeField.tsx` — extended grade scale 1–13 → 2–16 (F-=2, A+=16). Added `FilterSection` wrapper, `RangeSliderField`, `onClear` prop, `useEffect` state sync. `handleClear` resets to `[2, 16]`.
  - Modified `src/components/fields/YearField.tsx` — added `FilterSection` wrapper, `RangeSliderField`, `onClear` prop, `useEffect` state sync, `findClosestYear` function for sparse year arrays. Slider syncs bidirectionally with dropdowns via numeric year values.
  - Modified `src/components/filter-and-sort/FilterAndSortContainer.tsx` — complete rewrite. New `SortOption = { label, value }` type; `SortProps<T>` now uses `sortOptions: readonly SortOption[]` and `onSortChange: (value: T) => void`. Added `sideNav`, `activeFilters`, `onRemoveFilter` props. Added `AppliedFilters` section in drawer, mobile sort radio section (uncontrolled, read via `FormData` on "View Results"), `suppressSortScrollRef` to prevent auto-scroll when sort changes via mobile drawer. Renamed `topNav` → `sideNav` (layout now `flex flex-row-reverse`).
  - Modified `src/components/filter-and-sort/FilterAndSortHeader.tsx` — sort dropdown hidden on mobile (`hidden tablet:block`). Filter button shows "Filter & Sort" on mobile, "Filter" on desktop. Options rendered via `sortOptions.map()`.
  - Modified `src/components/filter-and-sort/ReviewedWorkSortOptions.tsx` — converted from JSX component to exported `REVIEWED_WORK_SORT_OPTIONS: readonly SortOption[]` constant.
  - Modified `src/components/filter-and-sort/CollectionSortOptions.tsx` — same conversion to `COLLECTION_SORT_OPTIONS: readonly SortOption[]`.
  - Modified `src/components/filter-and-sort/FilterAndSortContainer.spec.tsx` — added "mobile sort section" describe block (7 tests) and "applied filters" describe block (6 tests). Updated `sortOptions` mock from JSX to array.
  - Modified `src/components/filter-and-sort/FilterAndSortContainer.testHelper.ts` — added `clickSortRadioOption(user, value)`.
  - Modified `src/features/authors/Authors.tsx` — `topNav` → `sideNav`, `COLLECTION_SORT_OPTIONS`, `onSortChange(value)`.
  - Modified `src/features/reviews/Reviews.tsx` — `REVIEWED_WORK_SORT_OPTIONS` spread with author options, `onSortChange(value)`.
  - Modified `src/features/author-titles/AuthorTitles.tsx` — `REVIEWED_WORK_SORT_OPTIONS`, `onSortChange(value)`.
  - Modified `src/features/reading-log/ReadingLog.tsx` — inline sort options as array, `onSortChange(value)`.
  - Fixed `src/features/reviews/Reviews.spec.tsx` and `AuthorTitles.spec.tsx` — updated grade filter test data to new scale (F→3, B→12, A+→16).

- Files changed:
  - MODIFIED: src/components/fields/GradeField.tsx
  - MODIFIED: src/components/fields/YearField.tsx
  - MODIFIED: src/components/filter-and-sort/FilterAndSortContainer.tsx
  - MODIFIED: src/components/filter-and-sort/FilterAndSortHeader.tsx
  - MODIFIED: src/components/filter-and-sort/ReviewedWorkSortOptions.tsx
  - MODIFIED: src/components/filter-and-sort/CollectionSortOptions.tsx
  - MODIFIED: src/components/filter-and-sort/FilterAndSortContainer.spec.tsx
  - MODIFIED: src/components/filter-and-sort/FilterAndSortContainer.testHelper.ts
  - MODIFIED: src/features/authors/Authors.tsx
  - MODIFIED: src/features/reviews/Reviews.tsx
  - MODIFIED: src/features/author-titles/AuthorTitles.tsx
  - MODIFIED: src/features/reading-log/ReadingLog.tsx
  - MODIFIED: src/features/reviews/Reviews.spec.tsx (grade scale fix)
  - MODIFIED: src/features/author-titles/AuthorTitles.spec.tsx (grade scale fix)

- Test results: 266 tests passed, snapshots updated (0 failures). `npm run check` clean (0 errors).

- **Learnings for future iterations:**
  - Grade scale migration breaks grade filter tests: test mock data must use new scale values (F=3, B=12, A+=16). The filter compares `gradeValue` numerically against the slider/dropdown range [min, max].
  - `suppressSortScrollRef` pattern: mobile drawer "View Results" reads sort from `FormData`, calls `onSortChange`, sets `suppressSortScrollRef.current = true` BEFORE `onSortChange` so the sort-change `useEffect` skips the scroll (the drawer closes and scrolls explicitly instead).
  - `topNav` → `sideNav` is a layout change: sideNav renders inside `flex flex-row-reverse` alongside the list, not above it. Authors' `AlphabetNav` moved from above-list to alongside-list this way.
  - `SortProps<T>` cascade was large: 2 sort option files + 4 feature components + header + spec all needed updating when changing from `React.ReactNode` to `readonly SortOption[]`.
  - Stage 2 did NOT include TextField.tsx changes (not required by plan tasks).
  - **NOT YET COMMITTED** — needs lint/format pass before commit.

- **Next: Stage 3** — Reducer layer changes:
  - `filtersReducer.ts`: add `RemoveAppliedFilterAction`.
  - `titleFiltersReducer.ts`: `kind` string → `readonly string[]`.
  - `reviewedTitleFiltersReducer.ts`: `reviewedStatus` string → `readonly string[]`, add `gradeValue` remove handler.
  - `collectionFiltersReducer.ts`: add `name` remove handler.
  - `ReadingLog.reducer.ts`: `edition`/`reviewedStatus` string → `readonly string[]`.
  - `filterTitles.ts`, `filterReadingLog.ts`, `createReviewedStatusFilter.ts`, `filterReviewedTitles.ts`: type updates.
  - `api/reviews.ts`, `getAuthorTitlesProps.ts`: replace private `gradeToValue` with `~/utils/grades`.

---

## 2026-02-24 - Stage 2: Lint/Format Pass + Commit

- What was implemented:
  - Fixed ESLint errors: removed unused `ReviewsSort` import from `Reviews.tsx`.
  - Added `--background-color-stripe` CSS variable to `src/css/tailwind.css` (used by `CheckboxListField` and `RangeSliderField` for the `bg-stripe` Tailwind utility class).
  - Added `.range-input` component styles to `src/css/tailwind.css` (used by `RangeSliderField` for styling dual-handle range slider thumbs across webkit and moz).
  - Fixed `perfectionist/sort-objects` and `better-tailwindcss/enforce-consistent-class-order` lint errors via `npm run lint:fix`.
  - Ran Prettier on 5 files (`FILTER_REDESIGN_SPEC.md`, 4 feature tsx files).
  - All 266 tests pass. `npm run lint`, `npm run check`, `npm run format` all clean.

- Files changed:
  - MODIFIED: src/features/reviews/Reviews.tsx (removed unused import)
  - MODIFIED: src/css/tailwind.css (added bg-stripe CSS var + range-input component)
  - MODIFIED: src/components/fields/RangeSliderField.tsx (class order fix by lint:fix)
  - MODIFIED: src/utils/grades.ts (object key sort fix by lint:fix)
  - MODIFIED: src/features/author-titles/AuthorTitles.tsx (prettier)
  - MODIFIED: src/features/authors/Authors.tsx (prettier)
  - MODIFIED: src/features/reading-log/ReadingLog.tsx (prettier)
  - MODIFIED: FILTER_REDESIGN_SPEC.md (prettier)

- **Learnings for future iterations:**
  - Porting `CheckboxListField` and `RangeSliderField` from movie log requires adding their CSS dependencies: `--background-color-stripe` CSS variable and `.range-input` component styles to `tailwind.css`. The book log linter (`better-tailwindcss/no-unknown-classes`) catches missing classes immediately.
  - `perfectionist/sort-objects` requires numeric object keys to be sorted ascending (e.g., `{2: ..., 3: ..., 4: ...}`) — the grade maps from the spec have them sorted descending for readability; linter fixes them automatically.
  - When removing a type import, also check that the type wasn't actually needed for any prop/type annotations elsewhere in the file.

---
