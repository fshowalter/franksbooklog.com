## 2026-02-23 - Spec Plan Stage 1: Rename fields in readings/reviews; update stats schemas

### What was implemented
- Updated `src/content.config.ts` — `ReadingSchema`:
  - Renamed `work_slug: reference("reviewedWorks")` → `workSlug: z.string()` (plain string, no longer a reference)
  - Renamed `edition_notes` → `editionNotes`
  - Added `slug: z.string()` field (unique reading ID = filename stem)
  - Added `date: z.coerce.date()` field
  - Updated AIDEV-NOTE comment
- Updated `src/content.config.ts` — `readings` loader `buildData`:
  - `frontmatter.edition_notes` → `frontmatter.editionNotes`
  - `frontmatter.work_slug` → `frontmatter.workSlug`
  - Added `slug: frontmatter.slug as string`
  - Added `date: frontmatter.date`
- Updated `src/content.config.ts` — `ReviewSchema`:
  - Renamed `work_slug: reference("reviewedWorks")` → `slug: reference("reviewedWorks")`
- Updated `src/content.config.ts` — `reviews` loader `buildData`:
  - `frontmatter.work_slug as string` → `frontmatter.slug as string`
  - Field key `work_slug:` → `slug:`
- Updated `src/content.config.ts` — `MostReadAuthorSchema`:
  - Removed `MostReadAuthorReadingSchema` entirely
  - Changed `readings: z.array(MostReadAuthorReadingSchema)` → `readings: z.array(reference("readings"))`
- Updated `src/api/reviews.ts`:
  - `reviews.find((r) => r.work_slug.id === work.slug)` → `r.slug.id`
  - `readings.find((r) => r.work_slug.id === review.slug)` → `r.workSlug === review.slug`
  - Updated AIDEV-NOTE comments
- Updated `src/features/review/getReviewProps.ts`:
  - `reviews.find((r) => r.work_slug.id === ref.id)` → `r.slug.id`
- Updated `src/features/stats/getStatsProps.ts`:
  - Added `buildStatsMaps()` helper — fetches `readings` and `reviewedWorks` collections, builds lookup maps
  - `createMostReadAuthorsListItemValueProps` now takes `readingsMap` and `worksMap`
  - Resolves each reading ref via `readingsMap.get(ref.id)!`, derives title/reviewed from `worksMap`
  - Cover image uses `{ slug: reading.workSlug }` instead of old embedded `reading.slug`
  - Date uses `reading.date` (Date object) instead of old embedded `reading.date` (string)
- Updated `src/features/stats/MostReadAuthors.tsx`:
  - Removed `readingSequence: number` from `ReadingSubListItemValue` type
  - Changed React key from `reading.readingSequence` to `reading.slug` (work slug)
- Updated `src/api/__fixtures__/readings.ts`:
  - `work_slug: { collection, id }` → `workSlug: "..."` (plain string)
  - `edition_notes: undefined` → `editionNotes: undefined`
  - Added `slug: "..."` (unique reading ID)
  - Added `date: new Date(...)`
- Updated `src/api/__fixtures__/reviews.ts`:
  - `work_slug: { collection, id }` → `slug: { collection, id }` (field renamed, still a reference)
  - Reordered fields alphabetically

### Files changed
- `src/content.config.ts` (updated)
- `src/api/reviews.ts` (updated)
- `src/features/review/getReviewProps.ts` (updated)
- `src/features/stats/getStatsProps.ts` (updated)
- `src/features/stats/MostReadAuthors.tsx` (updated)
- `src/api/__fixtures__/readings.ts` (updated)
- `src/api/__fixtures__/reviews.ts` (updated)
- `.astro/data-store.json` (deleted to force rebuild)
- `plan.md` (Stage 1 status → In Progress)
- `progress.txt` (this file)

### Learnings for future iterations:
- **`MostReadAuthorReadingSchema` removal breaks `MostReadAuthors.tsx`** — removing the embedded reading schema means the component's `ReadingSubListItemValue` type must also change; `readingSequence` is no longer available, use `reading.slug` (work slug) as React key instead
- **Stats props need `reviewedWorks` too** — after removing embedded readings from stats JSON, `getStatsProps.ts` needs both `readings` (for edition/date) and `reviewedWorks` (for title/reviewed status); the spec diff was simplified
- **`MostReadAuthorReadingSchema.slug` was the WORK slug** — in the old stats JSON, each embedded reading had `slug` = work slug; in `ReadingData`, `slug` is the unique reading ID and `workSlug` is the work slug; don't confuse them
- **Reading frontmatter fields are already renamed in content files** — `workSlug:`, `editionNotes:`, `date:`, `slug:` are already in the `.md` files; just need to update the loader to read them
- **`review` frontmatter already uses `slug:` not `work_slug:`** — the review .md files already have the new frontmatter key

---
